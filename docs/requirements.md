# PomodoroFlow-Rs 需求文档

## 项目概述

PomodoroFlow-Rs 是一个基于 Rust 和 Tauri 开发的桌面 GUI 应用，结合番茄钟（Pomodoro Timer）和待办事项管理功能，帮助用户提高工作效率。

## 核心价值

- **专注工作**: 通过番茄钟技术帮助用户保持专注
- **任务管理**: 简单高效的任务创建、组织和跟踪
- **本地优先**: 数据存储在本地，无需网络连接
- **跨平台**: 支持 Windows、macOS、Linux

## 功能需求

### 1. 番茄钟模块

#### 1.1 计时器功能
- **倒计时显示**: 实时显示剩余时间，格式为 MM:SS
- **周期管理**: 工作/短休息/长休息三种周期类型
- **默认时长**:
  - 工作周期: 25 分钟 (1500 秒)
  - 短休息: 5 分钟 (300 秒)
  - 长休息: 15 分钟 (900 秒，每 4 个工作周期后)
- **周期切换**: 工作周期完成后自动进入休息周期
- **循环计数**: 记录已完成的工作周期数量
- **进度显示**: 可视化进度条或百分比

#### 1.2 控制功能
- **开始**: 启动当前周期计时
- **暂停**: 暂停计时，保留剩余时间
- **重置**: 重置当前周期，重新开始
- **跳过**: 手动跳过当前周期，进入下一周期
- **配置**: 支持自定义各周期时长（1-120 分钟）

#### 1.3 提醒功能
- **系统通知**: 计时结束时发送系统通知
- **声音提醒**: 播放提示音（可选）
- **视觉提示**: UI 状态变化

### 2. 待办事项模块

#### 2.1 任务管理
- **创建任务**: 添加新任务（标题 + 描述）
- **编辑任务**: 修改任务标题和描述
- **删除任务**: 删除任务（永久删除）
- **任务状态**: 切换待办/进行中/已完成
- **快速操作**: 复选框快速切换状态

#### 2.2 任务展示
- **列表视图**: 以列表形式展示所有任务
- **状态过滤**: 按状态筛选（全部/待办/进行中/已完成）
- **搜索功能**: 按标题搜索任务
- **排序**: 按创建时间/更新时间排序
- **任务详情**: 点击查看任务详细信息

#### 2.3 数据字段
- **标题**: 任务标题（必填，最大 200 字符）
- **描述**: 任务详细描述（可选，最大 5000 字符）
- **状态**: todo/in_progress/done
- **创建时间**: ISO 8601 格式
- **更新时间**: ISO 8601 格式

### 3. 数据持久化

#### 3.1 本地存储
- **SQLite 数据库**: 使用 rusqlite 存储本地数据
- **事务支持**: 保证数据一致性
- **索引优化**: 为常用查询添加索引
- **迁移机制**: 支持数据库结构升级

#### 3.2 数据表
- **user_config**: 用户配置信息
- **todos**: 待办事项数据
- **pomodoro_sessions**: 番茄钟会话历史

#### 3.3 数据管理
- **自动保存**: 配置更改自动保存
- **数据导出**: 导出为 JSON 格式（未来）
- **数据备份**: 自动备份机制（未来）

### 4. 用户界面

#### 4.1 布局设计
- **双栏布局**: 左侧番茄钟，右侧待办事项（桌面端）
- **单栏布局**: 垂直堆叠（移动端）
- **响应式**: 适配不同窗口尺寸
- **主题**: 支持浅色/深色/系统主题

#### 4.2 交互体验
- **快捷键**: 支持键盘快捷键操作
  - `Ctrl/Cmd + Space`: 开始/暂停番茄钟
  - `Ctrl/Cmd + N`: 新建任务
  - `Ctrl/Cmd + R`: 重置番茄钟
  - `Ctrl/Cmd + ,`: 打开设置
- **加载状态**: 显示加载指示器
- **错误提示**: 友好的错误消息
- **成功反馈**: 操作成功提示

#### 4.3 设置界面
- **番茄钟设置**: 自定义各周期时长
- **通知设置**: 配置提醒方式
- **主题设置**: 选择界面主题
- **关于页面**: 显示应用信息

### 5. 错误处理

#### 5.1 数据错误
- **数据库锁定**: 等待或重试机制
- **数据验证**: 严格的输入验证
- **迁移失败**: 回滚到上一个版本
- **磁盘空间**: 检测并提示空间不足

#### 5.2 用户提示
- **错误消息**: 友好的人类可读错误信息
- **操作反馈**: 操作成功/失败的即时反馈
- **状态提示**: 当前操作进度显示

## 非功能需求

### 性能要求
- **启动时间**: 应用启动时间 < 5 秒
- **响应时间**: UI 交互响应时间 < 100ms
- **内存使用**: 内存占用 < 150 MB
- **CPU 使用**: 后台任务 CPU 使用 < 5%

### 兼容性要求
- **操作系统**: 支持 Windows 10+, macOS 10.15+, Linux (Ubuntu 20.04+)
- **屏幕分辨率**: 最低 1024x768，推荐 1920x1080
- **数据格式**: UTF-8 编码

### 可用性要求
- **界面语言**: 中文（简化）
- **帮助文档**: 提供使用说明
- **错误恢复**: 崩溃后自动恢复数据

## 约束与假设

### 技术约束
- **语言版本**: Rust 1.70+ (2021 Edition)
- **GUI 框架**: Tauri 1.0+
- **数据库**: SQLite (rusqlite)
- **前端**: React 18 + TypeScript

### 业务约束
- **目标用户**: 个人用户
- **规模限制**: 单用户 < 1000 个任务
- **免费使用**: 所有功能免费
- **开源**: 代码开源（MIT 许可证）

### 环境假设
- **本地运行**: 无需网络连接
- **本地权限**: 用户有足够的系统权限安装应用
- **数据目录**: 使用系统标准数据目录

## 数据流分析

### 任务创建流程
```
用户输入任务 → 前端验证 → invoke(create_todo) → 后端验证
→ 保存到 SQLite → 返回结果 → 更新前端状态
```

### 番茄钟流程
```
点击开始 → invoke(start_pomodoro) → PomodoroService.start()
→ 启动计时任务 → 每秒发出事件 → 前端更新 UI
→ 完成后通知 → 切换到下一阶段
```

## 风险评估

### 低风险
- **UI 兼容性**: 不同操作系统的 UI 差异（Tauri 处理）
- **音频播放**: 不同平台的音频 API 差异
- **数据丢失**: 本地数据库损坏（可备份）

### 已缓解
- **性能问题**: 使用异步任务避免阻塞
- **并发问题**: 使用 Arc + Mutex 保证线程安全
- **数据一致性**: SQLite 事务保证

## 成功标准

### 功能完整性
- [x] 番茄钟计时准确，支持所有周期
- [x] 任务 CRUD 操作完整，数据不丢失
- [x] 设置功能正常工作
- [x] 通知和提醒功能正常工作

### 性能标准
- [x] 启动时间 < 5 秒
- [x] UI 响应时间 < 100ms
- [x] 1000 个任务时应用不卡顿

### 用户体验
- [x] 界面直观易用，无需学习成本
- [x] 错误提示清晰，帮助用户解决问题
- [x] 设置简单，5 分钟内完成配置

## 未来迭代计划

### v0.2.0
- [ ] 番茄钟统计页面
- [ ] 任务优先级
- [ ] 任务标签
- [ ] 批量导入/导出

### v0.3.0
- [ ] 自定义通知音效
- [ ] 更多主题选项
- [ ] 任务截止日期
- [ ] 任务提醒

### v1.0.0
- [ ] 跨平台打包发布
- [ ] 自动更新
- [ ] 多语言支持
- [ ] 插件系统

## 附录

### A. 快捷键列表
- `Space`: 开始/暂停番茄钟
- `Ctrl/Cmd + N`: 新建任务
- `Ctrl/Cmd + R`: 重置番茄钟
- `Ctrl/Cmd + ,`: 打开设置

### B. 配置参数
```toml
[pomodoro]
work_duration = 1500        # 25 分钟
short_break_duration = 300  # 5 分钟
long_break_duration = 900   # 15 分钟
cycles_until_long_break = 4 # 每 4 个工作周期

[notifications]
enabled = true
sound_enabled = true

[ui]
theme = "light"  # light / dark / system
```
